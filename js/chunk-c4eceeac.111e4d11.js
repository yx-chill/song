(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c4eceeac"],{"0ba7":function(e,t,n){"use strict";n.r(t);n("b0c0");var a=n("7a23"),r={class:"relative"},o={class:"flex justify-between gap-3 mb-2"},c={class:"w-3/4"},i={class:"songnamegroup relative mb-3"},l=Object(a["i"])("i",{class:"fas fa-compact-disc absolute top-2 left-3 text-xl"},null,-1),s={class:"composergroup relative mb-3"},u=Object(a["i"])("i",{class:"fas fa-marker absolute top-2 left-3 text-xl"},null,-1),d={class:"typegroup relative mb-3"},p=Object(a["i"])("i",{class:"fas fa-headphones absolute top-2 left-3 text-xl"},null,-1),b=["value"],f={class:"w-1/4"},g=Object(a["i"])("button",{type:"submit",class:"block w-full font-bold bg-green-600 text-white py-1.5 px-3 rounded transition hover:bg-green-700"}," 新增歌曲 ",-1),m={type:"reset",value:"清除資料",ref:"cleanData",class:"fixed -top-10 opacity-0"};function v(e,t,n,v,j,O){var h=Object(a["J"])("VeeField"),x=Object(a["J"])("ErrorMessage"),y=Object(a["J"])("UploadSong"),w=Object(a["J"])("UploadImg"),k=Object(a["J"])("VeeForm");return Object(a["A"])(),Object(a["h"])("section",r,[Object(a["l"])(k,{onSubmit:t[0]||(t[0]=function(e){return v.addSong(e)}),"validation-schema":v.songSchema,class:"bg-green-200 bg-opacity-80 p-4 rounded"},{default:Object(a["W"])((function(){return[Object(a["i"])("div",o,[Object(a["i"])("div",c,[Object(a["i"])("div",i,[l,Object(a["l"])(h,{type:"text",name:"songname",placeholder:"歌曲名稱",class:"h-10 pl-10 text-xl block w-full rounded mb-1"}),Object(a["l"])(x,{class:"text-red-600 font-bold",name:"songname"})]),Object(a["i"])("div",s,[u,Object(a["l"])(h,{type:"text",name:"composer",placeholder:"作者名稱",class:"h-10 pl-10 text-xl block w-full rounded mb-1"}),Object(a["l"])(x,{class:"text-red-600 font-bold",name:"composer"})]),Object(a["i"])("div",d,[p,Object(a["l"])(h,{as:"select",name:"music_type_id",value:"1",class:"password h-10 px-10 text-xl block w-full rounded mb-1"},{default:Object(a["W"])((function(){return[(Object(a["A"])(!0),Object(a["h"])(a["a"],null,Object(a["H"])(v.genres,(function(e){return Object(a["A"])(),Object(a["h"])("option",{key:e.id,value:e.id},Object(a["M"])(e.name),9,b)})),128))]})),_:1}),Object(a["l"])(x,{class:"text-red-600",name:"genre"})]),Object(a["l"])(y,{isClean:v.isClean,onUploadSong:v.uploadSong},null,8,["isClean","onUploadSong"])]),Object(a["i"])("div",f,[Object(a["l"])(w,{isClean:v.isClean,onUploadImg:v.uploadImg},null,8,["isClean","onUploadImg"])])]),g,Object(a["i"])("input",m,null,512)]})),_:1},8,["validation-schema"])])}var j=n("1da1"),O=(n("96cf"),n("0c0f")),h={class:"bg-white rounded border border-gray-200 relative flex flex-col"},x=Object(a["i"])("div",{class:"p-6 font-bold border-b border-gray-200"},[Object(a["i"])("span",{class:"card-title"},"上傳歌曲"),Object(a["i"])("i",{class:"fas fa-upload float-right text-green-400 text-2xl"})],-1),y={class:"p-6"},w=Object(a["i"])("h5",null,"Drop your files here",-1),k=[w],D=Object(a["i"])("p",{class:"text-red-500 text-sm font-bold"},"檔案限制 : 5MB",-1),C={class:"flex items-center gap-x-4 mt-3"},S={key:0},I={key:1,class:"font-bold"};function _(e,t,n,r,o,c){return Object(a["A"])(),Object(a["h"])("div",h,[x,Object(a["i"])("div",y,[Object(a["i"])("div",{class:Object(a["t"])(["w-full px-10 py-20 rounded text-center cursor-pointer border border-dashed border-gray-400 text-gray-400 transition duration-500 hover:text-white hover:bg-green-400 hover:border-green-400 hover:border-solid mb-3",{"bg-green-400 border-green-400 border-solid":r.isDragover}]),onDragend:t[0]||(t[0]=Object(a["Z"])((function(e){return r.isDragover=!1}),["prevent","stop"])),onDragover:t[1]||(t[1]=Object(a["Z"])((function(e){return r.isDragover=!0}),["prevent","stop"])),onDragenter:t[2]||(t[2]=Object(a["Z"])((function(e){return r.isDragover=!0}),["prevent","stop"])),onDragleave:t[3]||(t[3]=Object(a["Z"])((function(e){return r.isDragover=!1}),["prevent","stop"])),onDrop:t[4]||(t[4]=Object(a["Z"])((function(e){return r.upload(e)}),["prevent","stop"]))},k,34),D,Object(a["i"])("div",C,[Object(a["i"])("button",{type:"button",class:"block bg-green-500 rounded text-white hover:bg-green-400 duration-500 px-2 py-1",onClick:t[5]||(t[5]=function(){return r.choose&&r.choose.apply(r,arguments)})},"選擇歌曲"),r.file?(Object(a["A"])(),Object(a["h"])("p",S,[Object(a["k"])(Object(a["M"])(r.file.name)+" ",1),Object(a["i"])("i",{class:"fa fa-times text-xl ml-3 cursor-pointer",onClick:t[6]||(t[6]=function(){return r.cancelFile&&r.cancelFile.apply(r,arguments)})})])):(Object(a["A"])(),Object(a["h"])("p",I,"尚未上傳歌曲"))]),Object(a["i"])("input",{class:"fixed -top-10 opacity-0",type:"file",name:"file",accept:"audio/mpeg",onChange:t[7]||(t[7]=function(e){return r.upload(e)}),ref:"fileDom"},null,544)])])}var A=n("6650"),U={name:"UploadSong",emits:["uploadSong"],props:["isClean"],setup:function(e,t){var n=t.emit,r=Object(a["N"])(e,"isClean"),o=Object(a["G"])(null),c=Object(a["G"])(!1),i=Object(a["G"])(""),l=function(){o.value.click()},s=function(){o.value.value="",i.value="",n("uploadSong",i.value)},u=function(e){return c.value=!1,i.value=e.dataTransfer?e.dataTransfer.files[0]:e.target.files[0],i.value.size>5242880?(Object(A["c"])("超過檔案大小限制","請選擇歌曲檔案"),o.value.vlue="",void(i.value="")):"audio/mpeg"!==i.value.type?(Object(A["c"])("檔案格式錯誤","請選擇歌曲檔案"),o.value.vlue="",void(i.value="")):void n("uploadSong",i.value)};return Object(a["U"])(r,(function(){s()})),{file:i,fileDom:o,isDragover:c,choose:l,cancelFile:s,upload:u,isClean:r}}},G=n("6b0d"),R=n.n(G);const F=R()(U,[["render",_]]);var J=F,E={class:"bg-white p-4 rounded"},T=Object(a["i"])("h3",{class:"text-xl"},"音樂圖片",-1),Z={class:"w-full border aspect-w-1 aspect-h-1 mb-4 rounded overflow-hidden relative"},q={class:"w-full h-full"},z=["src"];function B(e,t,n,r,o,c){return Object(a["A"])(),Object(a["h"])("div",E,[T,Object(a["i"])("div",Z,[Object(a["i"])("div",q,[r.preview?(Object(a["A"])(),Object(a["h"])("img",{key:0,src:r.preview,alt:"music photo",class:"w-full h-full"},null,8,z)):Object(a["g"])("",!0),r.preview?(Object(a["A"])(),Object(a["h"])("i",{key:1,class:"fa fa-times text-xl cursor-pointer px-1 absolute top-3 right-3 rounded-full",onClick:t[0]||(t[0]=function(){return r.cancelImg&&r.cancelImg.apply(r,arguments)})})):Object(a["g"])("",!0)])]),Object(a["i"])("button",{type:"button",class:"block bg-green-500 rounded text-white hover:bg-green-400 duration-500 px-2 py-1",onClick:t[1]||(t[1]=function(){return r.chooseImg&&r.chooseImg.apply(r,arguments)})},"選擇圖片"),Object(a["i"])("input",{class:"fixed -top-10 opacity-0",type:"file",name:"image",accept:"image/*",onChange:t[2]||(t[2]=function(e){return r.upload(e)}),ref:"imgDom"},null,544)])}var M={name:"UploadImg",emits:["uploadImg"],props:["isClean"],setup:function(e,t){var n=t.emit,r=Object(a["N"])(e,"isClean"),o=Object(a["G"])(null),c=Object(a["G"])(""),i=Object(a["G"])(""),l=function(e){if(-1!==e.target.files[0].type.indexOf("image")){i.value=e.target.files[0],n("uploadImg",i);var t=new FileReader;t.readAsDataURL(i.value),t.addEventListener("load",(function(e){c.value=e.target.result}))}else Object(A["c"])("檔案格式錯誤","請選擇圖片檔案")},s=function(){o.value.click()},u=function(){o.value.value="",i.value="",c.value="",n("uploadImg",i)};return Object(a["U"])(r,(function(){u()})),{imgDom:o,preview:c,upload:l,chooseImg:s,cancelImg:u}}};const P=R()(M,[["render",B]]);var L=P,N=n("babd"),V=function(){var e=Object(a["E"])({genres:[]}),t=function(){var t=Object(j["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(O["b"])("v1/admin/music-type").then((function(t){e.genres=t.data.data})).catch((function(e){console.log(e)}));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),n=Object(a["O"])(e),r=n.genres;return{genres:r,getGenres:t}},W=function(){var e=Object(a["E"])({file:[]}),t=function(t){e.file=t};return{songData:e,uploadSong:t}},H=function(){var e=Object(a["E"])({file:[]}),t=function(t){e.file=t};return{imgData:e,uploadImg:t}},K=function(e,t){var n=Object(a["G"])(null),r=Object(a["G"])(!1),o=function(){var a=Object(j["a"])(regeneratorRuntime.mark((function a(o){var c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.file){a.next=3;break}return Object(A["a"])("尚未上傳歌曲"),a.abrupt("return");case 3:return c=new FormData,c.append("name",o.songname),c.append("composer",o.composer),c.append("music_type_id",o.music_type_id),c.append("file",e.file),t.file&&c.append("image",t.file),Object(N["b"])("新增中..."),a.next=12,Object(O["c"])("v1/admin/music",c,{headers:{"Content-Type":"multipart/form-data"}}).then((function(){Object(A["b"])("新增成功")})).catch((function(e){console.log(e.response.data.errors)}));case 12:Object(N["a"])(),r.value=!r.value,n.value.click();case 15:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}();return{isClean:r,cleanData:n,addSong:o}},Q={name:"AddSong",components:{UploadSong:J,UploadImg:L},setup:function(){var e={songname:"required|min:3|max:30",composer:"required|min:3|max:30",music_type_id:"required"},t=W(),n=t.songData,a=t.uploadSong,r=H(),o=r.imgData,c=r.uploadImg,i=V(),l=i.genres,s=i.getGenres,u=K(n,o),d=u.isClean,p=u.cleanData,b=u.addSong;return s(),{genres:l,isClean:d,cleanData:p,uploadSong:a,uploadImg:c,addSong:b,songSchema:e}}};const X=R()(Q,[["render",v]]);t["default"]=X},"0c0f":function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return p}));n("d3b7"),n("159b");var a=n("bc3a"),r=n.n(a),o=n("b250"),c=function(){return r()({method:"post",url:"https://api.sally-handmade.com/music/v1/admin/refresh",data:{refresh_token:o["a"].get("adminRefresh")}})},i=r.a.create({baseURL:"https://api.sally-handmade.com/music/",timeout:1e4});i.interceptors.request.use((function(e){return e.headers.Authorization="Bearer ".concat(o["a"].get("adminToken")),e}),(function(e){console.log(e)}));var l=!1,s=[];i.interceptors.response.use((function(e){return e}),(function(e){if(!e.response)return Promise.reject(e);var t=e.config;return 401===e.response.status?l?new Promise((function(e){s.push((function(n){t.headers.Authorization="Bearer ".concat(n),i(t).then((function(t){return e(t)}))}))})):(l=!0,c().then((function(e){o["a"].set("adminToken",e.data.access_token),o["a"].set("adminRefresh",e.data.refresh_token),t.headers.Authorization="Bearer ".concat(e.data.access_token),s.forEach((function(t){return t(e.data.access_token)})),s=[]})).catch((function(){alert("因長時間未上線，請重新登入"),o["a"].remove("adminToken"),o["a"].remove("adminRefresh")})).finally((function(){l=!1})),new Promise((function(e){i(t).then((function(t){return e(t)}))}))):Promise.reject(e)}));var u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.get(e,{params:t})},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return i.post(e,t,n)},p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.delete(e,{params:t})}}}]);
//# sourceMappingURL=chunk-c4eceeac.111e4d11.js.map